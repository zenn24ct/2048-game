<!doctype html>
<html lang="ja">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>2048</title>
    <style>
        :root {
            --bg: #f6f6f6;
            --board: #e9e9e9;
            --cell: #ffffff;
            --accent: #222;
        }

        html,
        body {
            height: 100%;
            margin: 0;
            font-family: system-ui, Arial, sans-serif;
            background: var(--bg);
            color: var(--accent);
            display: flex;
            align-items: center;
            justify-content: center
        }

        .app {
            width: 340px;
            max-width: 94vw;
            padding: 12px
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px
        }

        h1 {
            font-size: 20px;
            margin: 0
        }

        .score {
            font-weight: 700
        }

        /* （変更ポイント） board の列定義を「縮められる1fr」に */
        .board {
            width: 320px;
            height: 320px;
            background: var(--board);
            padding: 12px;
            border-radius: 8px;
            display: grid;
            /* ← ここを変更 */
            grid-template-columns: repeat(4, minmax(0, 1fr));
            gap: 12px;
            box-sizing: border-box;
            user-select: none;
        }

        /* cell を縮められるようにする（安全策） */
        .cell {
            background: var(--cell);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 20px;
            min-height: 64px;
            min-width: 0;
            /* ← ここを追加（重要） */
            overflow: hidden;
            /* 余剰テキストをはみ出させない */
        }

        /* tile をセル幅にピッタリ収める */
        .tile {
            width: 100%;
            /* セル幅に合わせる */
            box-sizing: border-box;
            /* padding を含めて計算 */
            padding: 20px 10px;
            /* 大きすぎるpaddingは縮小（必要なら調整） */
            border-radius: 6px;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }


        .v-2 {
            background: #fff876;
        }

        .v-4 {
            background: #d5ff99
        }

        .v-8 {
            background: #5ddd01
        }

        .v-16 {
            background: #55eafe
        }

        .v-32 {
            background: #385cff
        }

        .v-64 {
            background: #c459ff
        }

        .v-128 {
            background: #ff5ec4
        }

        .v-256 {
            background: #ff7b59
        }

        .v-512 {
            background: #ffb259
        }

        .v-1024 {
            background: #ff5972
        }

        .v-2048 {
            background: #ff5959
        }

        .controls {
            display: flex;
            gap: 8px;
            margin-top: 10px
        }

        button {
            padding: 8px 10px;
            border-radius: 8px;
            cursor: pointer;
            background: rgb(252, 187, 255)
        }

        @media (max-width:420px) {
            .board {
                width: 92vw;
                height: 92vw;

            }

            .cell {
                min-height: unset;
                padding: 6px
            }
        }
    </style>
</head>

<body>
    <div class="app" role="application" aria-label="2048シンプル版">
        <header>
            <h1>2048</h1>
            <div>
                <div class="score">Score: <span id="score">0</span></div>
                <div style="font-size:12px;color:#666">Best: <span id="best">0</span></div>
            </div>
        </header>

        <div id="board" class="board" aria-label="ゲーム盤"></div>

        <div class="controls">
            <button id="btnNew">New Game</button>

        </div>
    </div>

    <script>
        /* --- 状態 --- */
        const SIZE = 4;
        let grid = createEmpty();
        let score = 0;
        let best = Number(localStorage.getItem('2048_best') || 0);

        const boardEl = document.getElementById('board');
        const scoreEl = document.getElementById('score');
        const bestEl = document.getElementById('best');
        bestEl.textContent = best;

        /* --- ユーティリティ --- */
        function createEmpty() {
            return Array.from({ length: SIZE }, () => Array(SIZE).fill(0));
        }
        function copyGrid(g) { return g.map(row => row.slice()) }

        function addRandomTile(g) {
            const empties = [];
            for (let r = 0; r < SIZE; r++) for (let c = 0; c < SIZE; c++) if (g[r][c] === 0) empties.push([r, c]);
            if (empties.length === 0) return false;
            const [r, c] = empties[Math.floor(Math.random() * empties.length)];
            g[r][c] = Math.random() < 0.9 ? 2 : 4;
            return { r, c };
        }

        function rotateRight(g) {
            const out = createEmpty();
            for (let r = 0; r < SIZE; r++) for (let c = 0; c < SIZE; c++) out[c][SIZE - 1 - r] = g[r][c];
            return out;
        }
        function rotate(g, n) {
            let res = copyGrid(g);
            for (let i = 0; i < (n + 4) % 4; i++) res = rotateRight(res);
            return res;
        }

        function moveLeft(g) {
            const newG = createEmpty();
            let moved = false, gain = 0;
            for (let r = 0; r < SIZE; r++) {
                const line = g[r].filter(v => v !== 0);
                for (let i = 0; i < line.length - 1; i++) {
                    if (line[i] === line[i + 1]) {
                        line[i] *= 2;
                        gain += line[i];
                        line.splice(i + 1, 1);
                    }
                }
                for (let c = 0; c < line.length; c++) {
                    newG[r][c] = line[c];
                    if (newG[r][c] !== g[r][c]) moved = true;
                }
            }
            return { moved, gain, grid: newG };
        }

        function canMove(g) {
            for (let r = 0; r < SIZE; r++) for (let c = 0; c < SIZE; c++) {
                if (g[r][c] === 0) return true;
                const v = g[r][c];
                if (c + 1 < SIZE && g[r][c + 1] === v) return true;
                if (r + 1 < SIZE && g[r + 1][c] === v) return true;
            }
            return false;
        }

        /* --- 描画（簡素） --- */
        function render() {
            boardEl.innerHTML = '';
            for (let r = 0; r < SIZE; r++) {
                for (let c = 0; c < SIZE; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    const v = grid[r][c];
                    if (v !== 0) {
                        const tile = document.createElement('div');
                        tile.className = 'tile ' + 'v-' + v;
                        tile.textContent = v;
                        cell.appendChild(tile);
                    }
                    boardEl.appendChild(cell);
                }
            }
            scoreEl.textContent = score;
            bestEl.textContent = best;
        }

        /* --- メイン移動関数 --- (dir:0=left,1=up,2=right,3=down) */
        function move(dir) {
            const rotated = rotate(grid, -dir);
            const res = moveLeft(rotated);
            if (!res.moved) return false;
            const after = rotate(res.grid, dir);
            grid = after;
            score += res.gain;
            if (score > best) { best = score; localStorage.setItem('2048_best', best); }
            addRandomTile(grid);
            render();
            if (!canMove(grid)) setTimeout(() => alert('Game Over'), 30);
            return true;
        }

        /* --- 操作イベント --- */
        window.addEventListener('keydown', (e) => {
            const key = e.key;
            let handled = false;
            if (['ArrowLeft', 'a', 'A'].includes(key)) handled = move(0);
            else if (['ArrowUp', 'w', 'W'].includes(key)) handled = move(1);
            else if (['ArrowRight', 'd', 'D'].includes(key)) handled = move(2);
            else if (['ArrowDown', 's', 'S'].includes(key)) handled = move(3);
            if (handled) e.preventDefault();
        });

        document.getElementById('btnNew').addEventListener('click', startNew);

        /* --- 新規ゲーム --- */
        function startNew() {
            grid = createEmpty();
            score = 0;
            addRandomTile(grid);
            addRandomTile(grid);
            render();
        }

        /* 初回開始 */
        startNew();
    </script>
</body>

</html>
